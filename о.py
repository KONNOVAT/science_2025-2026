# Подключение нужных библиотек
from math import factorial as fct
import matplotlib.pyplot as plt
import numpy as np
np.seterr(divide='ignore', invalid='ignore')

print("=" * 70)
print("ЛАБОРАТОРНАЯ РАБОТА: РАСЧЕТ ВЕРОЯТНОСТНЫХ ХАРАКТЕРИСТИК МОДЕЛИ")
print("=" * 70)

# Получение входных данных
print("\n--- ВВОД ПАРАМЕТРОВ СИСТЕМЫ ---")
c = int(input("Введите значение пиковой пропускной способности соты (C): "))
lam_1 = int(input("Введите значение интенсивности поступления запросов 1-го типа (λ1): "))
lam_2 = int(input("Введите значение интенсивности поступления запросов 2-го типа (λ2): "))
len_o_1 = int(input("Введите длину передаваемого файла 1-го типа (O1): "))
len_o_2 = int(input("Введите длину передаваемого файла 2-го типа (O2): "))
n_block_1 = int(input("Введите число передаваемых блоков данных 1-го типа (n1): "))
n_block_2 = int(input("Введите число передаваемых блоков данных 2-го типа (n2): "))

# Лямбда массив
lam_range = np.arange(0, c, 0.5)

# Расчет интенсивности нагрузки
ro_1 = lam_1 * len_o_1
ro_2 = lam_2 * len_o_2
ro = lam_range * len_o_1

# Расчёт доли нагрузки
a1 = ro_1/c
a2 = ro_2/c
a = ro/c

print("\n--- РАСЧЕТ СТАЦИОНАРНОГО РАСПРЕДЕЛЕНИЯ ---")

# Расчёт стационарного распределения вероятностей состояний системы
# Вычисление p(0,0)
p0 = 0
for i in range(0, n_block_1+1):
    for j in range(0, n_block_2+1):
        p0 += fct(i+j)*((a1**i)/fct(i))*((a2**j)/fct(j))
p0 = 1/p0

# Вычисление p(n1,n2)
def stationary_distribution(n_block_1, n_block_2):
    p = ((a1**n_block_1)/fct(n_block_1))*((a2**n_block_2)/fct(n_block_2))*fct(n_block_1+n_block_2)*p0
    return p

# Запуск вычисления и вывод стационарной вероятности
sum_prob = 0
print("\nСтационарные вероятности:")
for i in range(0, n_block_1+1):
    for j in range(0, n_block_2+1):
        prob = stationary_distribution(i, j)
        print(f'p({i},{j}) = {prob:.6f}')
        sum_prob += prob

print('-' * 70)
print(f'Сумма значений стационарной вероятности = {sum_prob:.6f}')
print('-' * 70)

print("\n--- ВЕРОЯТНОСТИ БЛОКИРОВКИ ---")
# Вероятность блокировки по времени E1 запроса на передачу данных 1-го типа
E1 = 0
# Вероятность блокировки по времени E2 запроса на передачу данных 2-го типа
E2 = 0
# Вероятность блокировки по времени E1 запроса на передачу данных 1-го типа (для массива)
E1_range = 0
# Вероятность блокировки по времени E2 запроса на передачу данных 2-го типа (для массива)
E2_range = 0

print(f'Вероятность блокировки E1 (1-й тип) = {E1}')
print(f'Вероятность блокировки E2 (2-й тип) = {E2}')
print('-' * 70)

print("\n--- СРЕДНЕЕ ЧИСЛО ОБСЛУЖИВАЕМЫХ ЗАПРОСОВ ---")
# Расчёт среднего числа N1 обслуживаемых запросов 1-го типа
N1 = lam_1*(len_o_1/(ro_1+ro_2))
# Расчёт среднего числа N2 обслуживаемых запросов 2-го типа
N2 = lam_2*(len_o_2/(ro_1+ro_2))
# Расчёт для массива
N1_range = lam_range*(len_o_1/(ro+ro_2))
N2_range = lam_2*(len_o_2/(ro+ro_2))

print(f'Среднее число N1 (1-й тип) = {N1:.4f}')
print(f'Среднее число N2 (2-й тип) = {N2:.4f}')
print('-' * 70)

print("\n--- СРЕДНЕЕ ВРЕМЯ ОБСЛУЖИВАНИЯ ---")
# Расчёт среднего времени T1 обслуживания запроса 1-го типа
T1 = N1/lam_1
# Расчёт среднего времени T2 обслуживания запроса 2-го типа
T2 = N2/lam_2
# Расчёт для массива
T1_range = N1_range/lam_range
T2_range = N2_range/lam_2

print(f'Среднее время T1 (1-й тип) = {T1:.4f}')
print(f'Среднее время T2 (2-й тип) = {T2:.4f}')
print('-' * 70)

print("\n--- ПОСТРОЕНИЕ ГРАФИКОВ ---")

# График 1: Зависимость среднего времени обслуживания запроса от интенсивности
plt.figure(figsize=(12, 8))
plt.subplot(2, 1, 1)
plt.plot(lam_range, T1_range, color='#FF6B6B', linewidth=2, label='Первый тип')
plt.plot(lam_range, T2_range, color='#4ECDC4', linewidth=2, label='Второй тип')
plt.title('Зависимость среднего времени обслуживания от интенсивности поступления запросов (Коннова Т.)', fontsize=14, fontweight='bold')
plt.xlabel('Интенсивность поступления запросов', size=12)
plt.ylabel('Среднее время обслуживания', size=12)
plt.grid(True, alpha=0.3)
plt.legend()

# График 2: Зависимость среднего числа обслуживаемых запросов от интенсивности
plt.subplot(2, 1, 2)
plt.plot(lam_range, N1_range, color='#FFA726', linewidth=2, label='Первый тип')
plt.plot(lam_range, N2_range, color='#66BB6A', linewidth=2, label='Второй тип')
plt.title('Зависимость среднего числа обслуживаемых запросов от интенсивности (Коннова Т.)', fontsize=14, fontweight='bold')
plt.xlabel('Интенсивность поступления запросов', size=12)
plt.ylabel('Среднее число обслуживания', size=12)
plt.grid(True, alpha=0.3)
plt.legend()

plt.tight_layout()
plt.show()

print("\n" + "=" * 70)
print("РАСЧЕТЫ ЗАВЕРШЕНЫ")
print("=" * 70)